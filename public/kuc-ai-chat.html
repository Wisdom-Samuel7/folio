<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KnowUrCraft AI Chat Assistant</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.min.css">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in-up { animation: fadeInUp 0.4s ease forwards; }

    .typing { display: inline-flex; }
    .typing span { display: inline-block; width: 6px; height: 6px; background: #9ca3af; border-radius: 50%; margin: 0 2px; animation: blink 0.5s infinite both; }
    .typing span:nth-child(2) { animation-delay: 0.1s; }
    .typing span:nth-child(3) { animation-delay: 0.2s; }

    @keyframes blink { 0%,80%,100%{opacity:0;} 40%{opacity:1;} }
  </style>
</head>

<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white flex flex-col items-center justify-center min-h-screen px-4">

  <h1 class="text-3xl font-extrabold mb-6 text-indigo-400 tracking-tight text-center">
    KnowUrCraft AI Chat Assistant <span class="animate-pulse">ü§ñ</span>
  </h1>

  <!-- Chat Container -->
  <div class="backdrop-blur-lg bg-gray-800/70 rounded-2xl shadow-2xl w-full max-w-3xl h-[75vh] flex flex-col overflow-hidden border border-gray-700">
    
    <!-- Chat messages -->
    <div id="messages" class="flex-1 p-4 overflow-y-auto space-y-4 scroll-smooth">
      <div class="ai-msg bg-gray-700/80 p-3 rounded-lg w-fit fade-in-up shadow-sm">
        üëã Hey there! I‚Äôm <b>KnowUrCraft AI</b> ‚Äî your creative assistant.<br>
        Ask me about my music, projects, or development work!
      </div>
    </div>

    <!-- Input Form -->
    <form id="chatForm" class="flex items-center border-t border-gray-700 bg-gray-800/60 backdrop-blur-md">
      <input id="userInput" type="text" name="message" placeholder="Type your message..." 
        class="flex-1 bg-transparent p-4 outline-none text-white placeholder-gray-400 text-sm md:text-base" required>
      <button class="bg-indigo-600 hover:bg-indigo-700 px-6 py-4 transition-all duration-200">
        <i class="bi bi-send text-lg"></i>
      </button>
    </form>
  </div>

  <!-- Local sounds -->
  <audio id="userPop" src="/sounds/button-3.mp3" preload="auto"></audio>
  <audio id="aiBeep" src="/sounds/button-9.mp3" preload="auto"></audio>

<script>
  const form = document.getElementById('chatForm');
  const messages = document.getElementById('messages');
  const input = document.getElementById('userInput');
  const userPop = document.getElementById('userPop');
  const aiBeep = document.getElementById('aiBeep');

  function appendTyping() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'bg-gray-700 p-3 rounded-lg w-fit typing';
    typingDiv.innerHTML = '<span></span><span></span><span></span>';
    messages.appendChild(typingDiv);
    messages.scrollTop = messages.scrollHeight;
    return typingDiv;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;

    // Play user sound
    userPop.currentTime = 0;
    userPop.play();

    // User message
    const userDiv = document.createElement('div');
    userDiv.className = 'bg-indigo-600 text-white p-3 rounded-lg self-end w-fit ml-auto fade-in-up shadow';
    userDiv.textContent = text;
    messages.appendChild(userDiv);
    input.value = '';
    messages.scrollTop = messages.scrollHeight;

    // Show typing indicator
    const typingDiv = appendTyping();

    // Send to server
    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text }),
      });
      const data = await res.json();

      // Remove typing
      typingDiv.remove();

      // AI reply
      const aiDiv = document.createElement('div');
      aiDiv.className = 'bg-gray-700 p-3 rounded-lg w-fit fade-in-up shadow';
      aiDiv.textContent = data.reply;
      messages.appendChild(aiDiv);
      messages.scrollTop = messages.scrollHeight;

      // Play AI sound
      aiBeep.currentTime = 0;
      aiBeep.play();

    } catch (err) {
      typingDiv.remove();
      const errDiv = document.createElement('div');
      errDiv.className = 'bg-red-700 p-3 rounded-lg w-fit fade-in-up shadow';
      errDiv.textContent = '‚ö†Ô∏è Something went wrong. Please try again.';
      messages.appendChild(errDiv);
      messages.scrollTop = messages.scrollHeight;
    }
  });
</script>

</body>
</html>
